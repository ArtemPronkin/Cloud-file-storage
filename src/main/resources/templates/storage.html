<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org">
<head>
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" rel="stylesheet">

    <meta charset="UTF-8">
    <title>Login</title>
</head>
<body>
<form enctype="multipart/form-data" th:action="@{/storage/putFile}"

      th:method="POST">
    <table>
        <tr>
            <td>Выберите файлы для загрузки</td>
            <td><input accept="" multiple name="file" type="file"></td>
        </tr>
        <input name="path" th:value="${path}" type="hidden"/>
        <tr>
            <td><input type="submit" value="Отправить файлы"/></td>
        </tr>
    </table>
</form>

<form enctype="multipart/form-data" method="post" th:action="@{/storage/putFolder}">
    <input directory="" id="files" mozdirectory="" multiple="" name="file" type="file" webkitdirectory="">
    <input name="path" th:value="${path}" type="hidden"/>
    <input class="button" type="submit" value="Отправить папку"/>
</form>

<form th:action="@{/storage/createFolder}" th:method="POST">

    <table>
        <label>Создать новую папку
            <input name="folderName" type="text">
        </label>
        <input name="path" th:value="${path}" type="hidden"/>
        <tr>
            <td><input type="submit" value="Создать"/></td>
        </tr>
    </table>
</form>
<form th:action="@{/storage/search}" th:method="POST">
    <input name="path" th:value="${path}" type="hidden"/>
    <label>Поиск файла
        <input name="fileName"
               value=""
               type="text">
    </label>

    <input class="button" type="submit" value="Поиск"/>


</form>
<p>Текущий путь : <span th:text="${path}"></span></p>

<a th:href="@{'/storage?path='+${backPath}}"><span>...</span></a>
<div th:each="object : ${objectList}">
    <div th:with="folderName=${object.get().objectName()}">
        <div th:if="${object.get().isDir()}">
            <p>
                <a th:href="@{'/storage?path='+${folderName}}">
                    <span th:text="${folderName.substring(path.length(),folderName.length()-1)}"></span>
                </a>
                <a th:href="@{'/storage/deleteFolder?folderName='+${folderName}}"><span>  delete folder</span></a>

            <form th:action="@{/storage/renameFolder}" th:method="POST">
                <p>

                    <input name="path" th:value="${path}" type="hidden"/>
                    <input name="folderName" th:value="${folderName}" type="hidden"/>

                    <label>Изменить имя и путь папки
                        <input name="folderNameNew"
                               th:value="${folderName}"
                               type="text">
                    </label>

                    <input class="button" type="submit" value="Редактировать"/>

                </p>
            </form>
            </p>
        </div>
    </div>
</div>
</div>


<div th:each="object : ${objectList}">
    <div th:with="objectName=${object.get().objectName()}">
        <div th:with="objectNameWeb=${objectName.substring(object.get().objectName().lastIndexOf('/')+1)}">
            <div th:if="${!object.get().isDir()}">
                <div th:if="${!objectName.equals(path)}">
                    <div th:if="${!objectNameWeb.isEmpty()}">
                        <a th:href="@{'/storage/download?fileName='+${objectName}}">
                            <span th:text="${objectNameWeb}"></span>
                        </a>

                        <a th:href="@{'/storage/delete?fileName='+${objectName}}"><span>  delete</span></a>


                        <form th:action="@{/storage/transferFile}" th:method="POST">

                            <input name="path" th:value="${path}" type="hidden"/>
                            <input name="fileName"
                                   th:value="${objectName}"
                                   type="hidden"/>

                            <label>Имя новой папки
                                <input name="folderName" th:value="${path}" type="text">
                            </label>


                            <input class="button" type="submit" value="Перенести файл"/>

                        </form>
                        </p>
                        <form th:action="@{/storage/renameFile}" th:method="POST">


                            <input name="path" th:value="${objectName.substring(0,objectName.lastIndexOf('/')+1)}" type="hidden"/>
                            <input name="fileName" th:value="${objectName}" type="hidden"/>

                            <label>Новое имя
                                <input name="fileNameNew"
                                       th:value="${objectNameWeb}"
                                       type="text">
                            </label>

                            <input class="button" type="submit" value="Переименовать файл"/>


                        </form>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

</body>
</html>